---
title: 【基础】TCP三次握手、四次挥手
date: 2021-03-28 19:50:01
toc: true
tags:
- 面试 
- 计算机网络
categories:
- 基础
---
发送窗口：TCP中为了解决应答机制等待时间过长而引入的方法，如果没有窗口，则TCP每发送一次数据就必须等待应答，收到应答后继续发送，如果没有收到则等待一段时间后重发，如果很长时间都无法收到应答则判断为网络断开。而使用窗口后，窗口的大小指无需等待应答可以连续发送多个数据包。

接收窗口：TCP头部带有窗口，用于指示接收窗口大小。

拥塞窗口：根据网络情况确定的发送窗口大小，考虑到网络中的拥堵，比如路由器要处理的数据过多，导致缓冲区溢出而丢包。

发送时选择两者中小的作为发送窗口大小。

<!-- more -->

## 关键词
慢启动，快速重传，快速恢复。拥塞窗口和慢启动阀值。

## 过程
1. 通信开始时，发送方的拥塞窗口大小为 1。每收到一个 ACK 确认后，拥塞窗口大小加1。窗口大小成指数增长。（慢启动）
2. 由于指数级增长非常快，很快地，就会出现确认包超时，认为发生了拥塞。
3. 此时设置一个“慢启动阈值”，它的值是当前拥塞窗口大小的一半。
4. 拥堵发生后将拥塞窗口大小设置为 1，重新进入慢启动过程。
5. 由于现在“慢启动阈值”已经存在，当拥塞窗口大小达到阈值后，停止使用慢启动算法，开始采用拥塞避免算法。窗口大小开始线性增加。
6. 随着窗口大小不断增加，如果收到三次重复确认应答，则进入“快速重发”阶段。对于这用拥塞情况，TCP 将“慢启动阈值”设置为当前拥塞窗口大小的一半，再将拥塞窗口大小设置成阈值大小（也有说加 3）。然后采用拥塞避免算法增加窗口大小。
7. 随着窗口大小不断增加，如果发生超时。对于这种拥塞情况，TCP将满启动阀值设置为当前拥塞窗口的一半，然后将拥塞窗口设置为1。

## 重传
### 超时重传（RTO）
当一个包被发送后，就开启一个定时器，如果定时时间到了，还未收到能确认该发送包的应答包，就重传一份数据。注意收到的应答包可能是该包也可能是后面包的，但是只要能确认该包被收到就行。另外如果，是因为网络延时造成重传，则接受端收到重复数据包后丢弃该包。
### 快速重传
当如果发送端收到一个包的三次应答包后，立即重传，比超时重传更高效。


参考：https://blog.csdn.net/shanghairuoxiao/article/details/68927100