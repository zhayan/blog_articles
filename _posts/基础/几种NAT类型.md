---
title: 【基础】几种NAT类型
date: 2021-03-11 21:42:52
toc: true
tags:
- 面试 
- 计算机网络
categories:
- 基础
---
参考<https://blog.csdn.net/mycloudpeak/article/details/53550405>

NAT（Network Address Translation，网络地址转换）是1994年提出的。当在专用网内部的一些主机本来已经分配到了本地IP地址（即仅在本专用网内使用的专用地址），但现在又想和因特网上的主机通信（并不需要加密）时，可使用NAT方法。

<!-- more -->

NAT缓解了IPV4地址不够用的问题，同时也也带了限制，那就是NAT外部的主机无法主动跟位于NAT内部的主机通信，NAT内部主机想要通信，必须主动和公网的一个IP通信，网关负责建立一个映射关系，从而实现数据的转发， 这就是NAT的工作原理。

## 分类
NAT可以根据映射建立的依据分成两大类：锥型（Cone）和对称型（Symmetric）

锥形和对称型的区别在于：锥型映射的建立是根据内部主机的IP和端口号，对称型映射的建立是根据连接（即内部IP端口+目的IP端口）。

如：Client`192.168.0.2:100`发送报文给Server1`1.1.1.1:1111`，两种NAT都会建立映射，比如映射到网关`8.8.8.8:100`。当Client`192.168.0.2:100`发送报文给Server2`2.2.2.2:1111`时，锥型会直接使用之前映射的`8.8.8.8:100`发送，而对称型会重新建立映射，比如映射到`8.8.8.8:`<font color=red>101</font>。


## 锥型细分
锥型NAT又可以根据其对发送到映射后公网的IP端口报文如何处理细分为：
- 全锥型(Full Cone)
- 受限锥型(Restricted Cone)， 或IP受限锥型
- 端口受限锥型(Port Restricted Cone), 或IP + PORT受限锥型

client`192.168.0.2, 100`和server`1.1.1.1:1111`在通信后，映射到网关`8.8.8.8:100`，如果这个时候网关`8.8.8.8`在`800`端口上收到从server2`2.2.2.2:2222`发来的数据，根据是否转发给`192.168.0.3:100`可分类几种NAT。

1. 无条件转发给`192.168.0.2:100`， 这就是全锥型(Full Cone)NAT。

2. 如果`192.168.0.2:100`之前给`2.2.2.2`发送过数据，则转发， 这就是受限锥型(Restricted Cone)。

3. 如果`192.168.0.2:100`之前给`2.2.2.2:2222`发送过数据，则转发， 这就是端口受限锥型(Port Restricted Cone)。

4. 丢弃报文，拒绝转发, 这就是对称型NAT。

从上面也描述也可以看出，安全性系数,  对称型 > 端口受限锥型 > 受限锥型 > 全锥型



