---
title: 【每日一题_基础】输入URL到页面发生了什么
date: 2021-03-17 21:42:52
toc: true
tags:
- 面试 
- 计算机网络
categories:
- 每日一题_基础
---

更多问法：命令行输入`curl URL`发生了什么？不带有任何参数时，curl 就是发出 GET 请求。`-d`用于发送POST请求数据体。

<!-- more -->

1. URL 解析
   搜索功能
   http 或者 https，强制https
   安全检查、访问限制等（浏览器特色）
   检查缓存![检查缓存过程](/img/bowersCheck.webp)

2. DNS 查询
   浏览器缓存、本地缓存（host）、路由器缓存、DNS服务器（设置的）、根域名服务器（递归查询、迭代查询）
   DNS劫持，可发生在本机、路由器、DNS服务器
   DNS Prefetch，默认情况下浏览器会对页面中和当前域名（正在浏览网页的域名）不在同一个域的域名进行预获取，并且缓存结果。

3. TCP 连接
   + 应用层：构造HTTP报文，请求报头（Request Header）：请求方法、目标地址、遵循的协议等等 + 请求主体（其他参数）。浏览器只能发送 GET、POST 方法，而打开网页使用的是 GET 方法
   + 传输层：构造TCP报文段
    {% post_link  每日一题_基础/TCP分段和IP分片 TCP分段和IP分片%}
    {% post_link  每日一题_基础/TCP三次握手、四次挥手 TCP三次握手、四次挥手%}
   + 网络层：ARP协议，判断目标地址是否与当前地址处于同一网络中，是的话直接根据 Mac 地址发送，否则使用路由表查找下一跳地址，以及使用 ARP 协议查询它的 Mac 地址。
   + 链路层：以太网协议每一帧分为两个部分，
        - 标头：数据包的发送者、接受者、数据类型
        - 数据：数据包具体内容

4. 服务器连接
   监听得到的请求，然后开启一个子进程去处理这个请求。
   处理请求，对HTTP协议进行解析（请求方法、域名、路径等）验证是否配置虚拟主机，验证虚拟主机是否接受此方法，验证该用户可以使用该方法（根据 IP 地址、身份信息等）。
   假如服务器配置了 HTTP 重定向，就会返回一个 301永久重定向响应，浏览器就会根据响应，重新发送 HTTP 请求（重新执行上面的过程）。
   然后会查看 URL 重写规则，如果请求的文件是真实存在的，比如图片、html、css、js文件等，则会直接把这个文件返回。

5. 浏览器接收响应
   首先查看 Response header，根据不同状态码做不同的事（比如上面提到的重定向）。
   如果响应资源进行了压缩（比如 gzip），还需要进行解压。
   然后，对响应资源做缓存。接下来，根据响应资源里的 MIME 类型去解析响应内容（比如 HTML、Image各有不同的解析方式）。

6. 渲染页面
   HTML解析：解码（encoding）、预解析（pre-parsing）、符号化（Tokenization）、构建树（tree construction）（创建DOM）
   CSS解析：在匹配一个节点对应的 CSS 规则时，是按照从右到左的顺序。
   渲染树：DOM 树和 CSS 规则树合并的过程。当遇到一个script标签时，DOM 构建会被暂停，直至脚本完成执行，然后继续构建 DOM 树。、
   布局与绘制、合并渲染层、 回流与重绘

7. JS编译执行
   词法分析
   预编译
   执行



